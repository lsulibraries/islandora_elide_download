<?php

/**
 * @file
 * define hooks and menu
 */

/**
 * Implement hook_form_islandora_object_properties_form_alter().
 */

function islandora_elide_download_form_islandora_object_properties_form_alter(array &$form, array &$form_state) {
  module_load_include('inc', 'islandora_elide_download', 'includes/utilities');
  $form['toggle_elide_dl'] = array(
    '#type' => 'checkbox',
    '#title' => t('Hide Download Link'),
    '#description' => t('Check this box to hide download link from user'),
    '#default_value' => islandora_elide_download_is_listed($form['pid']['#value']),
  );
    array_unshift($form['#submit'], 'islandora_elide_download_submit_handler');
}

/**
 * Implement hook_islandora_object_ingested().
 * //works like a charm with one item and works with gui batch ingest
 */

// function islandora_elide_download_islandora_object_ingested($object) {
//   module_load_include('inc', 'islandora_elide_download', 'includes/utilities');
//   islandora_elide_download_elide($object->id);
// }

function islandora_elide_download_form_alter(&$form, &$form_state, $form_id){
  module_load_include('inc', 'islandora_elide_download', 'includes/utilities');
  if($form_id == 'islandora_ingest_form') {
    $form['toggle_elide_dl'] = array(
      '#type' => 'checkbox',
      '#title' => t('Hide Download Link'),
      '#description' => t('Check this box to hide download link from user'),
      '#default_value' => 0,
    );
    // foreach ($form_state['islandora']['objects'] as $obj) {
    //   $array = (array)$obj;
    //   $prefix = chr(0).'*'.chr(0);
    //   dpm($array[$prefix.'objectId']);
    //   islandora_elide_download_toggle_link('elide', $array[$prefix.'objectId']);
    //   }
    //islandora_elide_download_submit_handler($form, $form_state);
    array_push($form['#submit'], 'islandora_elide_download_submit_handler');
  }
}

/**
* Implements hook_preprocess().
*/

function islandora_elide_download_preprocess_islandora_large_image(&$variables) {
  dmp('something');
}

/**
* Implements hook_theme_registry_alter().
*/

function islandora_elide_download_theme_registry_alter(&$theme_registry) {
  module_load_include('inc', 'islandora_elide_download','includes/utilites');
  dpm($theme_registry);
  //islandora_elide_download_is_listed($pid);
  if (isset($theme_registry['islandora_large_image'])) {
    $module_path = drupal_get_path('module', 'islandora_elide_download');
    $theme_registry['islandora_large_image']['theme path'] = $module_path;
    $theme_registry['islandora_large_image']['path'] = $module_path . '/templates/';
  }
}



//find islandora_importer/zip_importer form and add option to elide links for all, or enable link for all.
function islandora_elide_download_islandora_ingest_form_alter(&$form, &$form_state){
    //array_unshift($form['#submit'], 'islandora_elide_download_submit_handler');
}
